 
<head>
    <meta charset="utf-8">
    <title>Section scroller one-page template</title>
    <meta name="description" content="recorder app" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Codeply">
    
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" />
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" />
    <link href="http://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" rel="stylesheet" />
    <link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Pacifico' rel='stylesheet' type='text/css'>
    
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1.32.min.js"></script>
    <script type="text/javascript">
      // See the Configuring section to configure credentials in the SDK
      AWS.config.update({accessKeyId: 'AKIAIYAMUFYEPYZNLLCQ', secretAccessKey: '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'});
      AWS.config.region = 'us-east-1';
    </script>
    <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.4.2.min.js"></script>
    <link rel="stylesheet" href="css/flipclock.css">
    <link rel="stylesheet" href="css/styles.css" />
    
  </head>


<body>

<!-- Header Navigation bar -->    
<nav class="navbar navbar-trans navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapsible">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand text-danger" href="#">StorySlam</a>
        </div>
        <div class="navbar-collapse collapse" id="navbar-collapsible">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="#" data-toggle="modal" data-target="#myModal"><i class="fa fa-heart-o fa-lg"></i></a></li>
            </ul>
        </div>
    </div>
</nav>



<section class="container-fluid" id="section1">

    <!-- submit Info section --> 
    <div class="v-center step submit" id="info" style="display:block;">
        <h1 class="text-center">Record Your Story</h1>
        <div class="row">
            <div class="lato centered-list center-block">
                 <div class="lato centered-list2 center-block">
                    <ol class="">
                        <li class="instructions">Add your Details</li>
                        <li class="instructions">Click Record</li>
                        <li class="instructions">Tell Your Story</li>
                    </ol>
                 </div>   

            </div>
        </div>

        <div class="row">
            <div class="lato centered-list center-block">
                <div class="lato centered-list2 center-block">
                <div class="form-group">
                    <div class="input-group input-group-lg">
                      <input type="text" class="form-control" id="userName" placeholder="Your first & last name" aria-describedby="basic-addon1" size="50">
                    </div>
                </div>
                <div class="form-group">
                    <div class="input-group input-group-lg">
                        <input type="text" class="form-control" id="userEmail" placeholder="Email address" aria-describedby="basic-addon1" size="50">
                    </div>
                </div>
                <div class="form-group">
                    <div class="input-group input-group-lg">
                      <input type="text" class="form-control" id="storyTitle" placeholder="Story Title" aria-describedby="basic-addon1" size="50">
                    </div>
                </div>
              </div>  
            </div>
        </div>
    
        <div class="row">
            <div class="lato centered-list center-block">    
                <button type="button" class="btn btn-danger btn-lg btn-huge latocenter-block lato center-block record-your-story" onclick="submitInfo()">
                    <i class="fa fa-microphone fa-circle"></i> Record Your Story
                </button>
            </div>
        </div>
    </div>

    <!-- Countdown Section -->    
    <div class="v-center step" id="countdown" style="display:none">
        <h3 class="text-center" id="greeting">Hi Jane Goodall</h3>
        <h1 class="text-center">Time to Tell Your Story</h1>
        <div class="row">
            <div class="lato centered-list center-block">
              <div class="countdown">
                  <div id="4">3</div>
                  <div id="3">2</div>
                  <div id="2">1</div>
                  <div class="begin" id="1" >Let's begin at the beginning...</div>
              </div>
            </div>        
        </div>
    </div>


    <!-- Record Section -->    
    <div class="v-center step" id="record" style="display:none">
        <h1 class="text-center blink_me">Recording</h1>
        <p class="descripter text-center">You can take up to 15 minutes to tell your story. Have Fun!</p>

          <div class="container center-block">
            <div class="row center-block">
              <div class="col-md-4"></div>
              <div class="record_countdown col-md-4 center-block"></div>
              <div class="col-md-4"></div>
            </div>
          </div>

          <div class="container center-block">
            <div class="row center-block">
               <div id="visualizer" style="text-align: center-block;"></div>
            </div>
          </div>

         <div class="row">
            <div class="lato centered-list center-block">
                <div class="lato centered-list2 center-block">
                   <button type="button" class="btn btn-danger btn-lg btn-huge latocenter-block lato center-block verify-button" onclick="stopRecording(this);">
                      <i class="fa fa-stop fa-circle"></i> Stop
                    </button>
                </div>   
            </div>
        </div>
    </div>

<!-- Verify Section --> 
    
    <div id="verify" class="v-center step" style="display:none;">
      <div class="col-md-6 col-md-offset-3">
        <h1 class="text-center">Review & Upload Your Story</h1>
        <div id="player">
          <div id="wave" style="text-align: center;"></div>
          <div class="controls" style="text-align: center;">
            
            <button class="btn btn-success btn-lg btn-huge latocenter-block lato center-block verify-button" data-action="play" onclick="playAudio(this);">
                <i class="fa fa-play"></i>
                Play
                /
                <i class="fa fa-pause"></i>
                Pause
            </button>

            <button class="btn btn-primary btn-lg btn-huge latocenter-block lato center-block data-action verify-button" data-action="record" onclick="submitAll();">
                <i class="fa fa-cloud-upload"></i>
                Upload & Submit
            </button>
            
            <div class="center-block or-you-can">Or you can ...</div>
            
            <button class="btn btn-danger btn-lg btn-huge latocenter-block lato center-block verify-button" data-action="record" onclick="reRecord();">
                <i class="glyphicon glyphicon-record"></i>
                Record Again
            </button>      

          </div>
        </div>

        <ul id="recordingslist"></ul>
        <br>
<!--         <button  class="btn btn-default" onclick="submitAll();">Submit</button>
        <br>
        <button  class="btn btn-default" onclick="reRecord();">Record Again</button>
 -->
      </div>
    </div>

<!-- Uploading Section --> 

  <div id="upload" class="row v-center step" style="display: none;">
    <div class="col-md-6 col-md-offset-3">
      <h1 class="text-center">Uploading your Story</h1>
      <p class="text-center descripter">This may take a couple minutes so please don't close your browser until you see our confirmation screen.</p>
      <br>

<!-- Fancy loader -->
      <div id="loader">
        <ul class="loader-ul">
          <li class="loader-li"></li>
          <li class="loader-li"></li>
          <li class="loader-li"></li>
          <li class="loader-li"></li>
          <li class="loader-li"></li>
          <li class="loader-li"></li>
        </ul>
      </div>
<!-- End Fancy loader -->

    </div>
  </div>


<!-- Story Submitted Section --> 

  <div id="confirm" class="v-center row step" style="display: none;">
    <div class="col-md-6 col-md-offset-3">
      <h1 class="text-center">Story Submitted</h1>
      <p class="text-center descripter">Congrats! Your story was submitted successfully. You can always be in touch with us at <a href="mailto:partners@storyslam.com">partners@storyslam.com.</a></p>
      <img class="headphone img-responsive center-block" src="img/headphone-icon-small.png">


    </div>
  </div>

<!-- Fucking Log Section --> 

</section>
<!--   <div id="logger" class="row">
    <div class="col-md-6 col-md-offset-3">
      <h2>Log</h2>
      <pre id="log"></pre>
    </div>
  </div>
 -->

<script>
  function logHTML(e, data) {
    console.log(e + " " + (data || ''));
    // if ($("#log")) {
    //   log.innerHTML += "\n" + e + " " + (data || '');
    // }
  }
  var audioContext;
  var audioRecorder;
  var _realAudioInput;
  var _realStream;
  var wavesurfer;
  var microphone;
  var visualizer;
  function handlerStartUserMedia(stream) {
    console.log('handlerStartUserMedia');
    console.log('sampleRate:'+ audioContext.sampleRate);
    // MEDIA STREAM SOURCE -> ZERO GAIN >
    _realStream = stream;
    _realAudioInput = audioContext.createMediaStreamSource(stream);
    audioRecorder = new Recorder(_realAudioInput);
  }
  function handlerErrorUserMedia(e) {
      logHTML('No live audio input: ' + e);
  }
  function startRecording(button) {
    console.log('in startRecording');
    if(!audioRecorder)
      return;

    console.log("HERE");
    if (!visualizer) {
      visualizer = Object.create(WaveSurfer);
      visualizer.init({
          container: '#visualizer',
          waveColor: 'orange',
          interact: false,
          cursorWidth: 0,
          minPxPerSec: 10
      });

      microphone = Object.create(WaveSurfer.Microphone);
      microphone.init({
          wavesurfer: visualizer
      });

      micro = microphone;

      microphone.gotStream(_realStream);
    }
    var clock = $('.record_countdown').FlipClock(900, {
      countdown: true,
      clockFace: 'MinuteCounter'
    });

    console.log("HERE");

    audioRecorder && audioRecorder.record();
    //GUI
    // button.disabled = true;
    // button.nextElementSibling.disabled = false;
    logHTML('Recording...');
  }

  function stopRecording(button) {
    if(!audioRecorder)
      return;
    audioRecorder && audioRecorder.stop();
    //GUI
    logHTML('Stopped recording.');
    logHTML('Loading visualization.');
    // wavesurfer.loadBlob(audioRecorder.currentRecording);
  
    stepToStep("verify");
  }

  function reRecord(e) {
    $(recordingslist).empty();
    startRecordCountdown();
  }

  function playAudio(button) {
    wavesurfer.playPause.bind(wavesurfer)();
  }

  function submitAll(e) {
    logHTML('Submitting.');
    audioRecorder.uploadAudioToStorage(function() {
      logHTML('Uploaded to storage.');
      audioRecorder.storeNewStory(function(status, object) {
        logHTML('Stored new story.');
        console.log(status);
        console.log(object);
        stepToStep("confirm");
      })
    });
    stepToStep("upload");        
  }

  function submitInfo(e) {
    if (!audioRecorder) {
      console.log("NO AUDIO RECORDER");
    } else {
      audioRecorder.userEmail = $("#userEmail").val();
      audioRecorder.storyTitle = $("#storyTitle").val();
      audioRecorder.userName = $("#userName").val();

      $("#greeting").text("Hi " + audioRecorder.userName);
      startRecordCountdown();
    }
  }

  function stepToStep(step) {
    logHTML("Stepping to step: " + step);
    $(".step").hide();
    $("#"+step).show();
  }


  function fadeCascade(current_count) {
    if (current_count == 0) {
      startRecording();
      stepToStep('record');
    } else {
      $("#"+current_count).fadeIn("slow", function() {
        $("#"+current_count).fadeOut("slow", function() {
          fadeCascade(current_count-1);
        });
      });
    }
  }

  function startRecordCountdown() {
    stepToStep('countdown');
    fadeCascade(4); 
  }


  window.onload = function init() {
    try {
      // webkit shim.
      window.AudioContext = window.AudioContext || window.webkitAudioContext || window.mozAudioContext;
      navigator.getUserMedia = (navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia);
      window.URL = window.URL || window.webkitURL;
      audioContext = new AudioContext;
      logHTML('Audio context set up.');
      logHTML('navigator.getUserMedia ' + (navigator.getUserMedia ? 'available.' : 'not present!'));
      wavesurfer = Object.create(WaveSurfer);
      wavesurfer.init({
          container: '#wave',
          waveColor: 'yellow',
          progressColor: 'green',
          cursorWidth: 3,
          cursorColor: 'white',
          fillParent: true
      });

    } catch (e) {
     alert('No web audio support in this browser!');
    }
    navigator.getUserMedia({video:false, audio: true}, handlerStartUserMedia, handlerErrorUserMedia);
  };

  </script>



<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>   

<script src="js/recorder.js"></script>
<script src="js/wavesurfer.min.js"></script>
<script src="js/wavesurfer.microphone.min.js"></script>
<script src="js/flipclock.min.js"></script>
</body>

